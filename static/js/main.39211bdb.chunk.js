(this.webpackJsonpp2pwebrct=this.webpackJsonpp2pwebrct||[]).push([[0],{32:function(e,t,c){},48:function(e,t,c){"use strict";c.r(t);var n=c(0),r=c.n(n),i=c(22),o=c.n(i),a=(c(32),c(26)),s=c(1),u=c(23),l=c.n(u);var d=e=>{const[t,c]=Object(n.useState)(e),r=Object(n.useRef)(null),i=Object(n.useCallback)(((e,t)=>{r.current=t,c((t=>"function"===typeof e?e(t):e))}),[]);return Object(n.useEffect)((()=>{r.current&&(r.current(t),r.current=null)}),[t]),[t,i]},f=c(27);var O=Object(f.a)("http://localhost:3001",{"force new connection":!0,reconnectionAttempts:"Infinity",timeout:1e4,transports:["websocket"]}),j=c(5),E=c.n(j);const p="LOCAL_VIDEO";var b=c(2);function h(){const{id:e}=Object(s.g)(),{clients:t,provideMediaRef:c}=function(e){const[t,c]=d([]),r=Object(n.useCallback)(((e,t)=>{c((t=>t.includes(e)?t:[...t,e]),t)}),[t,c]),i=Object(n.useRef)({}),o=Object(n.useRef)(null),a=Object(n.useRef)({[p]:null});return Object(n.useEffect)((()=>(O.on(E.a.ADD_PEER,(async function(e){let{peerID:t,createOffer:c}=e;if(t in i.current)return console.warn(`Already connected to peer ${t}`);i.current[t]=new RTCPeerConnection({iceServers:l()()}),i.current[t].onicecandidate=e=>{e.candidate&&O.emit(E.a.RELAY_ICE,{peerID:t,iceCandidate:e.candidate})};let n=0;if(i.current[t].ontrack=e=>{let{streams:[c]}=e;n++,2===n&&(n=0,r(t,(()=>{if(a.current[t])a.current[t].srcObject=c;else{let e=!1;const n=setInterval((()=>{a.current[t]&&(a.current[t].srcObject=c,e=!0),e&&clearInterval(n)}),1e3)}})))},o.current.getTracks().forEach((e=>{i.current[t].addTrack(e,o.current)})),c){const e=await i.current[t].createOffer();await i.current[t].setLocalDescription(e),O.emit(E.a.RELAY_SDP,{peerID:t,sessionDescription:e})}})),()=>{O.off(E.a.ADD_PEER)})),[]),Object(n.useEffect)((()=>(O.on(E.a.SESSION_DESCRIPTION,(async function(e){var t;let{peerID:c,sessionDescription:n}=e;if(await(null===(t=i.current[c])||void 0===t?void 0:t.setRemoteDescription(new RTCSessionDescription(n))),"offer"===n.type){const e=await i.current[c].createAnswer();await i.current[c].setLocalDescription(e),O.emit(E.a.RELAY_SDP,{peerID:c,sessionDescription:e})}})),()=>{O.off(E.a.SESSION_DESCRIPTION)})),[]),Object(n.useEffect)((()=>(O.on(E.a.ICE_CANDIDATE,(e=>{var t;let{peerID:c,iceCandidate:n}=e;null===(t=i.current[c])||void 0===t||t.addIceCandidate(new RTCIceCandidate(n))})),()=>{O.off(E.a.ICE_CANDIDATE)})),[]),Object(n.useEffect)((()=>(O.on(E.a.REMOVE_PEER,(e=>{let{peerID:t}=e;i.current[t]&&i.current[t].close(),delete i.current[t],delete a.current[t],c((e=>e.filter((e=>e!==t))))})),()=>{O.off(E.a.REMOVE_PEER)})),[]),Object(n.useEffect)((()=>(async function(){o.current=await navigator.mediaDevices.getUserMedia({audio:!0,video:{width:1280,height:720}}),r(p,(()=>{const e=a.current[p];e&&(e.volume=0,e.srcObject=o.current)}))}().then((()=>O.emit(E.a.JOIN,{room:e}))).catch((e=>console.error("Error getting userMedia:",e))),()=>{o.current.getTracks().forEach((e=>e.stop())),O.emit(E.a.LEAVE)})),[e]),{clients:t,provideMediaRef:Object(n.useCallback)(((e,t)=>{a.current[e]=t}),[])}}(e),r=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const t=Array.from({length:e}).reduce(((e,t,c,n)=>(c%2===0&&e.push(n.slice(c,c+2)),e)),[]),c=100/t.length+"%";return t.map(((e,t,n)=>t===n.length-1&&1===e.length?[{width:"100%",height:c}]:e.map((()=>({width:"50%",height:c}))))).flat()}(t.length);return Object(b.jsx)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",flexWrap:"wrap",height:"100vh"},children:t.map(((e,t)=>Object(b.jsx)("div",{style:r[t],id:e,children:Object(b.jsx)("video",{width:"100%",height:"100%",ref:t=>{c(e,t)},autoPlay:!0,playsInline:!0,muted:e===p})},e)))})}var I=c(50);function D(){const e=Object(s.f)(),[t,c]=Object(n.useState)([]),r=Object(n.useRef)();return Object(n.useEffect)((()=>{O.on(E.a.SHARE_ROOMS,(function(){let{rooms:e=[]}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r.current&&c(e)}))}),[]),Object(b.jsxs)("div",{ref:r,children:[Object(b.jsx)("h1",{children:"Available Rooms"}),Object(b.jsx)("ul",{children:t.map((t=>Object(b.jsxs)("li",{children:[t,Object(b.jsx)("button",{onClick:()=>{e.push(`/room/${t}`)},children:"JOIN ROOM"})]},t)))}),Object(b.jsx)("button",{onClick:()=>{e.push(`/room/${Object(I.a)()}`)},children:"Create New Room"})]})}function R(){return Object(b.jsx)("div",{children:"NOT FOUND."})}var m=function(){return Object(b.jsx)(a.a,{children:Object(b.jsxs)(s.c,{children:[Object(b.jsx)(s.a,{exact:!0,path:"/room/:id",component:h}),Object(b.jsx)(s.a,{exact:!0,path:"/",component:D}),Object(b.jsx)(s.a,{component:R})]})})};o.a.render(Object(b.jsx)(r.a.StrictMode,{children:Object(b.jsx)(m,{})}),document.getElementById("root"))},5:function(e,t){e.exports={JOIN:"join",LEAVE:"leave",SHARE_ROOMS:"share-rooms",ADD_PEER:"add-peer",REMOVE_PEER:"remove-peer",RELAY_SDP:"relay-sdp",RELAY_ICE:"relay-ice",ICE_CANDIDATE:"ice-candidate",SESSION_DESCRIPTION:"session-description"}}},[[48,1,2]]]);
//# sourceMappingURL=main.39211bdb.chunk.js.map